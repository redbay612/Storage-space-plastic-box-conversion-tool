<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>倉位塑膠箱換算與成本統計</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body { background-color: #f0f2f5; font-family: 'PingFang TC', 'Microsoft JhengHei', sans-serif; }
        .card { background: white; border-radius: 16px; box-shadow: 0 10px 15px -3px rgba(0,0,0,0.1); }
        .input-group:focus-within { border-color: #3b82f6; ring: 2px; }
    </style>
</head>
<body class="p-4 md:p-8">

    <div class="max-w-3xl mx-auto">
        <header class="text-center mb-8">
            <h1 class="text-3xl font-bold text-slate-800">📦 倉位箱體換算 & 統計</h1>
            <p class="text-slate-500 mt-2">自動計算才數上限、實體限制與領取總金額</p>
        </header>

        <!-- 第一步：輸入總才數 -->
        <div class="card p-6 mb-6">
            <label class="block text-lg font-semibold mb-2 text-slate-700">1. 設定倉位空間</label>
            <div class="flex gap-4">
                <div class="relative flex-1">
                    <input type="number" id="totalCapacity" value="100" class="w-full p-4 border rounded-xl text-2xl font-bold focus:ring-4 focus:ring-blue-100 outline-none transition-all" placeholder="輸入總才數">
                    <span class="absolute right-4 top-5 text-gray-400 font-bold">才</span>
                </div>
            </div>
        </div>

        <!-- 第二步：規則與上限顯示 -->
        <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-6 text-sm">
            <div class="card p-4 border-l-4 border-blue-500">
                <div class="font-bold text-blue-600 mb-1">大型箱 (20才)</div>
                <div class="text-gray-600">單價：$300</div>
                <div class="text-gray-600">上限：<span id="maxL" class="font-bold">--</span></div>
            </div>
            <div class="card p-4 border-l-4 border-green-500">
                <div class="font-bold text-green-600 mb-1">中型箱 (10才)</div>
                <div class="text-gray-600">單價：$250</div>
                <div class="text-gray-600">上限：<span id="maxM" class="font-bold">--</span></div>
            </div>
            <div class="card p-4 border-l-4 border-orange-500">
                <div class="font-bold text-orange-600 mb-1">小型箱 (5才)</div>
                <div class="text-gray-600">單價：$150</div>
                <div class="text-gray-600">上限：<span id="maxS" class="font-bold">--</span></div>
            </div>
        </div>

        <!-- 第三步：自定義組合 -->
        <div class="card p-6 mb-6">
            <h2 class="text-lg font-semibold mb-6 text-slate-700 border-b pb-2">2. 領取數量統計</h2>
            
            <div class="space-y-6">
                <!-- 大 -->
                <div class="flex items-center gap-4">
                    <div class="flex-1">
                        <span class="font-bold block text-blue-700">大型箱 (L)</span>
                        <span class="text-xs text-gray-400">$300 / 個</span>
                    </div>
                    <div class="flex items-center gap-2">
                        <input type="number" id="inputL" value="0" min="0" class="w-20 p-2 border rounded-lg text-center font-bold">
                        <span class="text-gray-400">個</span>
                    </div>
                    <div class="w-24 text-right font-mono text-slate-600" id="subtotalL">$0</div>
                </div>
                <!-- 中 -->
                <div class="flex items-center gap-4">
                    <div class="flex-1">
                        <span class="font-bold block text-green-700">中型箱 (M)</span>
                        <span class="text-xs text-gray-400">$250 / 個</span>
                    </div>
                    <div class="flex items-center gap-2">
                        <input type="number" id="inputM" value="0" min="0" class="w-20 p-2 border rounded-lg text-center font-bold">
                        <span class="text-gray-400">個</span>
                    </div>
                    <div class="w-24 text-right font-mono text-slate-600" id="subtotalM">$0</div>
                </div>
                <!-- 小 -->
                <div class="flex items-center gap-4">
                    <div class="flex-1">
                        <span class="font-bold block text-orange-700">小型箱 (S)</span>
                        <span class="text-xs text-gray-400">$150 / 個</span>
                    </div>
                    <div class="flex items-center gap-2">
                        <input type="number" id="inputS" value="0" min="0" class="w-20 p-2 border rounded-lg text-center font-bold">
                        <span class="text-gray-400">個</span>
                    </div>
                    <div class="w-24 text-right font-mono text-slate-600" id="subtotalS">$0</div>
                </div>
            </div>
        </div>

        <!-- 結果統計看板 -->
        <div id="resultCard" class="card p-6 border-2 transition-all duration-300">
            <div class="grid grid-cols-2 gap-4">
                <div class="text-center border-r">
                    <div class="text-sm text-gray-500 uppercase tracking-wider">總消耗才數</div>
                    <div id="usedCai" class="text-2xl font-black mt-1">0 / 100 才</div>
                </div>
                <div class="text-center">
                    <div class="text-sm text-gray-500 uppercase tracking-wider">應付總金額</div>
                    <div id="totalPrice" class="text-2xl font-black mt-1 text-blue-600">$0</div>
                </div>
            </div>
            
            <div id="statusText" class="mt-4 pt-4 border-t text-center font-bold text-lg"></div>
            <div id="limitWarnings" class="mt-2 space-y-1"></div>
        </div>

        <footer class="mt-8 text-xs text-gray-400 leading-relaxed bg-white/50 p-4 rounded-lg">
            <strong>⚠️ 換算與限制規則：</strong><br>
            • 大型(20才, $300) | 中型(10才, $250) | 小型(5才, $150)<br>
            • 單一倉位實體數量上限：大型 15 個、中型 30 個、小型 15 個。<br>
            • 系統會自動根據「才數空間」與「數量限制」進行雙重檢核。
        </footer>
    </div>

    <script>
        const config = {
            L: { cai: 20, limit: 15, price: 300 },
            M: { cai: 10, limit: 30, price: 250 },
            S: { cai: 5, limit: 15, price: 150 }
        };

        const elements = {
            totalCapacity: document.getElementById('totalCapacity'),
            inputL: document.getElementById('inputL'),
            inputM: document.getElementById('inputM'),
            inputS: document.getElementById('inputS'),
            maxL: document.getElementById('maxL'),
            maxM: document.getElementById('maxM'),
            maxS: document.getElementById('maxS'),
            subtotalL: document.getElementById('subtotalL'),
            subtotalM: document.getElementById('subtotalM'),
            subtotalS: document.getElementById('subtotalS'),
            usedCai: document.getElementById('usedCai'),
            totalPrice: document.getElementById('totalPrice'),
            resultCard: document.getElementById('resultCard'),
            statusText: document.getElementById('statusText'),
            warnings: document.getElementById('limitWarnings')
        };

        function updateUI() {
            const totalCaiLimit = parseFloat(elements.totalCapacity.value) || 0;
            
            // 1. 計算單項上限顯示
            elements.maxL.innerText = Math.min(Math.floor(totalCaiLimit / config.L.cai), config.L.limit) + ' 個';
            elements.maxM.innerText = Math.min(Math.floor(totalCaiLimit / config.M.cai), config.M.limit) + ' 個';
            elements.maxS.innerText = Math.min(Math.floor(totalCaiLimit / config.S.cai), config.S.limit) + ' 個';

            // 2. 獲取目前輸入數值
            const valL = parseInt(elements.inputL.value) || 0;
            const valM = parseInt(elements.inputM.value) || 0;
            const valS = parseInt(elements.inputS.value) || 0;

            // 3. 計算費用小計
            const costL = valL * config.L.price;
            const costM = valM * config.M.price;
            const costS = valS * config.S.price;
            elements.subtotalL.innerText = '$' + costL.toLocaleString();
            elements.subtotalM.innerText = '$' + costM.toLocaleString();
            elements.subtotalS.innerText = '$' + costS.toLocaleString();

            // 4. 計算總計
            const usedCai = (valL * config.L.cai) + (valM * config.M.cai) + (valS * config.S.cai);
            const totalPrice = costL + costM + costS;

            elements.usedCai.innerText = `${usedCai} / ${totalCaiLimit} 才`;
            elements.totalPrice.innerText = '$' + totalPrice.toLocaleString();

            // 5. 規則驗證
            elements.warnings.innerHTML = '';
            let isOver = usedCai > totalCaiLimit;
            
            if (usedCai > totalCaiLimit) addWarning(`才數超標 (超過 ${usedCai - totalCaiLimit} 才)`);
            if (valL > config.L.limit) { addWarning(`大型箱超過 15 個上限`); isOver = true; }
            if (valM > config.M.limit) { addWarning(`中型箱超過 30 個上限`); isOver = true; }
            if (valS > config.S.limit) { addWarning(`小型箱超過 15 個上限`); isOver = true; }

            // 6. 更新狀態樣式
            if (isOver) {
                elements.resultCard.classList.remove('border-transparent', 'bg-green-50');
                elements.resultCard.classList.add('border-red-500', 'bg-red-50');
                elements.statusText.innerText = '⚠️ 無法領取：超過限制';
                elements.statusText.className = 'mt-4 pt-4 border-t text-center font-bold text-lg text-red-600';
            } else if (usedCai === 0) {
                elements.resultCard.className = 'card p-6 border-transparent transition-all';
                elements.statusText.innerText = '請輸入領取數量';
                elements.statusText.className = 'mt-4 pt-4 border-t text-center font-bold text-lg text-slate-400';
            } else {
                elements.resultCard.classList.remove('border-red-500', 'bg-red-50');
                elements.resultCard.classList.add('border-green-500', 'bg-green-50');
                elements.statusText.innerText = '✅ 組合正確，准予領取';
                elements.statusText.className = 'mt-4 pt-4 border-t text-center font-bold text-lg text-green-600';
            }
        }

        function addWarning(msg) {
            const div = document.createElement('div');
            div.className = 'text-sm text-red-500 font-semibold text-center';
            div.innerText = msg;
            elements.warnings.appendChild(div);
        }

        // 監聽所有輸入欄位
        Object.values(elements).forEach(el => {
            if(el.tagName === 'INPUT') {
                el.addEventListener('input', updateUI);
            }
        });

        // 初始化
        updateUI();
    </script>
</body>
</html>